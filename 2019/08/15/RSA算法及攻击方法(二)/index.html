<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">

<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">


  
  
    
    
  <script src="/blank-vax.github.io/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/blank-vax.github.io/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/blank-vax.github.io/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/blank-vax.github.io/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/blank-vax.github.io/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/blank-vax.github.io/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/blank-vax.github.io/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/blank-vax.github.io/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/blank-vax.github.io/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="RSA,">





  <link rel="alternate" href="/blank-vax.github.io/atom.xml" title="B1ank" type="application/atom+xml">






<meta name="description" content="0x00 前言上一篇文章介绍了RSA的加解密过程及相关的数学基础以及对应的基础CTF题目,下面介绍几种针对加密过程中不同参数的攻击方法.   0x01 加密指数eRabin加密Rabin加密是RSA的衍生算法,e==2是Rabin加密的典型特征,加密过程可以表示为c = m^2 mod n, 解密过程为m = c^(1/2) mod n.详细算法可以参考Rabin加密体制   python实现">
<meta name="keywords" content="RSA">
<meta property="og:type" content="article">
<meta property="og:title" content="RSA算法及攻击方法(二)">
<meta property="og:url" content="https://blank-vax.github.io/2019/08/15/RSA算法及攻击方法(二)/index.html">
<meta property="og:site_name" content="B1ank">
<meta property="og:description" content="0x00 前言上一篇文章介绍了RSA的加解密过程及相关的数学基础以及对应的基础CTF题目,下面介绍几种针对加密过程中不同参数的攻击方法.   0x01 加密指数eRabin加密Rabin加密是RSA的衍生算法,e==2是Rabin加密的典型特征,加密过程可以表示为c = m^2 mod n, 解密过程为m = c^(1/2) mod n.详细算法可以参考Rabin加密体制   python实现">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://static.zybuluo.com/B1ank/4daca4b9ozlypgv26lha3dob/1.png">
<meta property="og:image" content="http://static.zybuluo.com/B1ank/1tpnsfcs7ne4jachn5pkydxm/2.png">
<meta property="og:image" content="http://static.zybuluo.com/B1ank/5q8jhm7n2jipnofpspmmqlil/3.png">
<meta property="og:image" content="http://static.zybuluo.com/B1ank/x4r70t8961voxq9zemanxjw7/5.png">
<meta property="og:image" content="http://static.zybuluo.com/B1ank/ro2jz9fgdxuyp9p7tjc2lx45/1.png">
<meta property="og:image" content="http://static.zybuluo.com/B1ank/af7d02gk7xfeyf9q7zf9636p/3.png">
<meta property="og:image" content="http://static.zybuluo.com/B1ank/mjt8cit6vxais5bwpn6t99cb/2.png">
<meta property="og:image" content="http://static.zybuluo.com/B1ank/zecvquc04wbkq38al8pp2nfz/4.png">
<meta property="og:image" content="http://static.zybuluo.com/B1ank/odlq2klwyutrumz8gbi7bqaj/5.png">
<meta property="og:updated_time" content="2020-11-09T03:25:04.759Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RSA算法及攻击方法(二)">
<meta name="twitter:description" content="0x00 前言上一篇文章介绍了RSA的加解密过程及相关的数学基础以及对应的基础CTF题目,下面介绍几种针对加密过程中不同参数的攻击方法.   0x01 加密指数eRabin加密Rabin加密是RSA的衍生算法,e==2是Rabin加密的典型特征,加密过程可以表示为c = m^2 mod n, 解密过程为m = c^(1/2) mod n.详细算法可以参考Rabin加密体制   python实现">
<meta name="twitter:image" content="http://static.zybuluo.com/B1ank/4daca4b9ozlypgv26lha3dob/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blank-vax.github.io/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blank-vax.github.io/2019/08/15/RSA算法及攻击方法(二)/">





  <title>RSA算法及攻击方法(二) | B1ank</title>
  









</head>


<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	<a href="https://github.com/blank-vax" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/blank-vax.github.io/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">B1ank</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blank-vax.github.io/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/blank-vax.github.io/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blank-vax.github.io/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/blank-vax.github.io/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blank-vax.github.io/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/blank-vax.github.io/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            日程表
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blank-vax.github.io/blank-vax.github.io/2019/08/15/RSA算法及攻击方法(二)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="B1ank">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/blank-vax.github.io/uploads/picture.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="B1ank">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">RSA算法及攻击方法(二)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-15T21:28:00+08:00">
                2019-08-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blank-vax.github.io/categories/Crypto-Attack/" itemprop="url" rel="index">
                    <span itemprop="name">Crypto_Attack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/blank-vax.github.io/2019/08/15/RSA算法及攻击方法(二)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/blank-vax.github.io/2019/08/15/RSA算法及攻击方法(二)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/blank-vax.github.io/2019/08/15/RSA算法及攻击方法(二)/" class="leancloud_visitors" data-flag-title="RSA算法及攻击方法(二)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
                 <span>℃<span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,459
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  28
                </span>
              
            </div>
          

          

        </span></span></div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>上一篇文章介绍了RSA的加解密过程及相关的数学基础以及对应的基础CTF题目,下面介绍几种针对加密过程中不同参数的攻击方法.  </p>
<h2 id="0x01-加密指数e"><a href="#0x01-加密指数e" class="headerlink" title="0x01 加密指数e"></a>0x01 加密指数e</h2><h3 id="Rabin加密"><a href="#Rabin加密" class="headerlink" title="Rabin加密"></a>Rabin加密</h3><p>Rabin加密是RSA的衍生算法,e==2是Rabin加密的典型特征,加密过程可以表示为<code>c = m^2 mod n</code>, 解密过程为<code>m = c^(1/2) mod n</code>.<br>详细算法可以参考<a href="https://www.cnblogs.com/jcchan/articles/8441159.html" target="_blank" rel="noopener">Rabin加密体制</a> </p>
<ul>
<li><p>python实现</p>
</li>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rabin_decrypt</span><span class="params">(c, p, q, e=<span class="number">2</span>)</span>:</span></span><br><span class="line">    n = p * q</span><br><span class="line">    mp = pow(c, (p + <span class="number">1</span>) / <span class="number">4</span>, p)</span><br><span class="line">    mq = pow(c, (q + <span class="number">1</span>) / <span class="number">4</span>, q)</span><br><span class="line">    yp = gmpy2.invert(p, q)</span><br><span class="line">    yq = gmpy2.invert(q, p)</span><br><span class="line">    r = (yp * p * mq + yq * q * mp) % n</span><br><span class="line">    rr = n - r</span><br><span class="line">    s = (yp * p * mq - yq * q * mp) % n</span><br><span class="line">    ss = n - s</span><br><span class="line">    <span class="keyword">return</span> (r, rr, s, ss)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">函数返回四个数字,其中只有一个是我们想要的明文,需要通过其他的方法进行验证.</span><br><span class="line"></span><br><span class="line">* 典型题目  </span><br><span class="line">题目来源: Jarvis OJ hard RSA  </span><br><span class="line">题目分析: 题目给出了.enc文件和.pem文件,我们使用openssl命令读取后发现该加密的加密指数e=2,属于典型的Rabin加密体系,考虑使用脚本进行解密.   </span><br><span class="line">解题脚本:  </span><br><span class="line"></span><br><span class="line">* ```python</span><br><span class="line">import gmpy2,libnum</span><br><span class="line">n=0xC2636AE5C3D8E43FFB97AB09028F1AAC6C0BF6CD3D70EBCA281BFFE97FBE30DD</span><br><span class="line">p=275127860351348928173285174381581152299</span><br><span class="line">q=319576316814478949870590164193048041239</span><br><span class="line">e=2</span><br><span class="line">c=int(open(filepath,&apos;rb&apos;).read().encode(&apos;hex&apos;),16)</span><br><span class="line">mp=pow(c,(p+1)/4,p)</span><br><span class="line">mq=pow(c,(q+1)/4,q)</span><br><span class="line">yp=gmpy2.invert(p,q)</span><br><span class="line">yq=gmpy2.invert(q,p)</span><br><span class="line">r=(yp*p*mq+yq*q*mp)%n</span><br><span class="line">rr=n-r</span><br><span class="line">s=(yp*p*mq-yq*q*mp)%n</span><br><span class="line">ss=n-s</span><br><span class="line">print libnum.n2s(r)</span><br><span class="line">print libnum.n2s(rr)</span><br><span class="line">print libnum.n2s(s)</span><br><span class="line">print libnum.n2s(ss)</span><br></pre></td></tr></table></figure>
<h3 id="低加密指数攻击"><a href="#低加密指数攻击" class="headerlink" title="低加密指数攻击"></a>低加密指数攻击</h3><p>当加密指数e较小且明文m也不大时,由于<code>m^e=k*n+m</code>中的k很小甚至为0,我们可以爆破k或者直接开e次方即可.</p>
<ul>
<li><p>python实现</p>
</li>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">small_msg</span><span class="params">(e, n, c)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> time.asctime(), <span class="string">"Let's waiting..."</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> xrange(<span class="number">200000000</span>):</span><br><span class="line">        <span class="keyword">if</span> gmpy2.iroot(c + n * k, e)[<span class="number">1</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">print</span> time.asctime(), <span class="string">"...done!"</span></span><br><span class="line">            <span class="keyword">return</span> gmpy2.iroot(c + n * k, e)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 典型题目  </span><br><span class="line">题目来源: Jarvis OJ Extremely hard RSA   </span><br><span class="line">题目分析: 该题目提供的n为4096位,e=3.我们可以使用上述脚本进行爆破.判断停止条件为开三次方根的结果为整数,使用的开方函数为`gmpy2.iroot()`    </span><br><span class="line">解题脚本: </span><br><span class="line"> </span><br><span class="line">* ```python</span><br><span class="line">import gmpy2,binascii,libnum,time</span><br><span class="line">n=given_n(hex)</span><br><span class="line">e=3</span><br><span class="line">res=0</span><br><span class="line">c=int(open(filepath, &apos;rb&apos;).read().encode(&apos;hex&apos;),16)</span><br><span class="line">print time.asctime()</span><br><span class="line">for i in xrange(200000000):</span><br><span class="line">    if gmpy2.iroot(c+n*i,3)[1]==1:</span><br><span class="line">        res=gmpy2.iroot(c+n*i,3)[0]</span><br><span class="line">        print i,res</span><br><span class="line">        print libnum.n2s(res)</span><br><span class="line">        print time.asctime()</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>
<h3 id="低加密指数广播攻击"><a href="#低加密指数广播攻击" class="headerlink" title="低加密指数广播攻击"></a>低加密指数广播攻击</h3><p>如果模数n和密文c不同,而明文m和加密指数e相同.一般取e=k,k为所给数据的数量且e较小.在题目中会得到多个形如<code>m^e == ci (mod ni)</code>的加密等式.取e=3,则有:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c1 = m^e mod n1</span><br><span class="line">c2 = m^e mod n2</span><br><span class="line">c3 = m^e mod n3</span><br></pre></td></tr></table></figure>
<p>对上述等式运用中国剩余定理,在e=3时,有:<br><code>cx = m^3 mod n1*n2*n3</code><br>对cx进行开方即可求得明文.</p>
<ul>
<li><p>典型例题<br>题目来源: 2018强网杯nextrsa-Level9<br>题目分析: 该题目给出了c1,c2,c3,n1,n2,n3,我们考虑使用中国剩余定理CRT()函数和iroot()函数进行爆破.<br>解题脚本: </p>
</li>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">m = random.randint(<span class="number">0x100000000000</span>, <span class="number">0xffffffffffff</span>)</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">n1 = modulus1</span><br><span class="line">n2 = modulus2</span><br><span class="line">n3 = modulus3</span><br><span class="line">c1 = pow(m, e, n1)</span><br><span class="line">c2 = pow(m, e, n2)</span><br><span class="line">c3 = pow(m, e, n3)</span><br><span class="line"><span class="keyword">print</span> m == gmpy2.iroot(CRT([n1, n2, n3], [c1, c2, c3]), e)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### CopperSmith Theorem</span><br><span class="line">该定理指出在一个e阶的模n多项式f(x)中,如果有一个根小于n^(1/e),就可以运用一个O(log n)的算法求出这些根.      </span><br><span class="line">该定理运用在rsa算法中,如果e=3并且明文当中有三分之二比特是已知的,这种算法可以还原出明文中所有的比特.   </span><br><span class="line"></span><br><span class="line">* sage实现的解题脚本</span><br><span class="line"></span><br><span class="line">* ```sage</span><br><span class="line">n= number1(hex)</span><br><span class="line">p=0xBCF6D95C9FFCA2B17FD930C743BCEA314A5F24AE06C12CE62CDB6E8306A545DE468F1A23136321EB82B4B8695ECE58B763ECF8243CBBFADE0603922C130ED143D4D3E88E483529C820F7B53E4346511EB14D4D56CB2B714D3BDC9A2F2AB655993A31E0EB196E8F63028F9B29521E9B3609218BA0000000000000000000000000</span><br><span class="line">p_fake = p+0x10000000000000000000000000</span><br><span class="line">pbits = 1024</span><br><span class="line">kbits = pbits-576</span><br><span class="line">pbar = p_fake &amp; (2^pbits-2^kbits)</span><br><span class="line">print &quot;upper %d bits (of %d bits) is given&quot; % (pbits-kbits, pbits)</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = x + pbar</span><br><span class="line">x0 = f.small_roots(X=2^kbits, beta=0.4)[0]  # find root &lt; 2^kbits with factor &gt;= n^0.4</span><br><span class="line">print x0 + pbar</span><br></pre></td></tr></table></figure>
<ul>
<li>详细解释参考<a href="https://www.52pojie.cn/thread-653446-1-1.html" target="_blank" rel="noopener">Coppersmith</a>及维基百科说明</li>
<li><a href="https://sagecell.sagemath.org/" target="_blank" rel="noopener">sage在线运行</a></li>
</ul>
<h3 id="e与-phi-n-不互素"><a href="#e与-phi-n-不互素" class="headerlink" title="e与$\phi$(n)不互素"></a>e与$\phi$(n)不互素</h3><p>只有当e与$\phi$(n)互素时,才能保证e的逆元d唯一存在.当二者不互素时,我们通过gcd()操作寻找与$\phi$(n)互素的数,然后进行求解.我们通过一个例题来说明.<br>题目描述:   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">n1=0xcfc59d54b4b2e9ab1b5d90920ae88f430d39fee60d18dddbc623d15aae645e4e50db1c07a02d472b2eebb075a547618e1154a15b1657fbf66ed7e714d23ac70bdfba4c809bbb1e27687163cb09258a07ab2533568192e29a3b8e31a5de886050b28b3ed58e81952487714dd7ae012708db30eaf007620cdeb34f150836a4b723L</span><br><span class="line">e1=0xfae3aL</span><br><span class="line">c1=0x81523a330fb15125b6184e4461dadac7601340960840c5213b67a788c84aecfcdc3caf0bf3e27e4c95bb3c154db7055376981972b1565c22c100c47f3fa1dd2994e56090067b4e66f1c3905f9f780145cdf8d0fea88a45bae5113da37c8879c9cdb8ee9a55892bac3bae11fbbabcba0626163d0e2e12c04d99f4eeba5071cbeaL</span><br><span class="line">n2=0xd45304b186dc82e40bd387afc831c32a4c7ba514a64ae051b62f483f27951065a6a04a030d285bdc1cb457b24c2f8701f574094d46d8de37b5a6d55356d1d368b89e16fa71b6603bd037c7f329a3096ce903937bb0c4f112a678c88fd5d84016f745b8281aea8fd5bcc28b68c293e4ef4a62a62e478a8b6cd46f3da73fa34c63L</span><br><span class="line">e2=0x1f9eaeL</span><br><span class="line">c2=0x4d7ceaadf5e662ab2e0149a8d18a4777b4cd4a7712ab825cf913206c325e6abb88954ebc37b2bda19aed16c5938ac43f43966e96a86913129e38c853ecd4ebc89e806f823ffb802e3ddef0ac6c5ba078d3983393a91cd7a1b59660d47d2045c03ff529c341f3ed994235a68c57f8195f75d61fc8cac37e936d9a6b75c4bd2347L</span><br><span class="line">assert pow(flag,e1,n1)==c1</span><br><span class="line">assert pow(flag,e2,n2)==c2</span><br><span class="line">assert gcd(e1,(p1-1)*(q1-1))==14</span><br><span class="line">assert gcd(e2,(p2-1)*(q2-1))==14</span><br></pre></td></tr></table></figure>
<p>题目分析:题目给出了n1和n2,我们联想到公约数,通过<code>p=gcd(n1,n2)</code>求得p,进而求出q1和q2.此时我们发现e与$\phi$(n)不互素.<br>如果我们需要求逆元,则需要找到与$\phi$(n)互素的数.    </p>
<p><img src="http://static.zybuluo.com/B1ank/4daca4b9ozlypgv26lha3dob/1.png" alt="1.png-11.4kB"><br>我们已知b=14,通过上面的推算我们可得a与$\phi$(n)互素,于是求出<code>b*d = gmpy2.invert(a,phin)</code>,进而求出d.可是经测试发现明文为乱码.<br>根据推导的最后一个公式,b*d可作为私钥求解出m^14.我们得到一个同余方程组.<br><img src="http://static.zybuluo.com/B1ank/1tpnsfcs7ne4jachn5pkydxm/2.png" alt="2.png-4kB"><br>进一步推导<br><img src="http://static.zybuluo.com/B1ank/5q8jhm7n2jipnofpspmmqlil/3.png" alt="3.png-5.4kB"><br>可以运用中国剩余定理计算特解m,即<code>m=solve_crt([m1,m2,m3], [q1,q2,p])</code>.如果模n1,n2不行那么可以转换为模q1*q2,从而有res $\equiv$ m^14 mod q1*q2.<br>这样就转换成一个新的rsa问题,且e=14.此时e与$\phi$(n)=(q1-1)*(q2-1)还有公因数2.那么我们参照上述思路,可以得出m^2满足的方程,从而开方求结果.<br><img src="http://static.zybuluo.com/B1ank/x4r70t8961voxq9zemanxjw7/5.png" alt="5.png-7.9kB"><br>解题脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p=gcd(n1,n2)</span><br><span class="line">q1=n1/p</span><br><span class="line">q2=n2/p</span><br><span class="line"><span class="keyword">assert</span>(p*q1==n1)</span><br><span class="line"><span class="keyword">assert</span>(p*q2==n2)</span><br><span class="line">f1=(p<span class="number">-1</span>)*(q1<span class="number">-1</span>)</span><br><span class="line">f2=(p<span class="number">-1</span>)*(q2<span class="number">-1</span>)</span><br><span class="line">tmp=<span class="number">14</span></span><br><span class="line"></span><br><span class="line">e1=e1/tmp</span><br><span class="line">e2=e2/tmp</span><br><span class="line">bd1=invmod(e1,f1)</span><br><span class="line">bd2=invmod(e2,f2)</span><br><span class="line"></span><br><span class="line">m1=pow(c1,bd1,n1)</span><br><span class="line">m2=pow(c2,bd2,n2)</span><br><span class="line">m3=m1%p</span><br><span class="line">m2=m2%q2</span><br><span class="line">m1=m1%q1</span><br><span class="line"></span><br><span class="line">m=solve_crt([m1,m2,m3], [q1,q2,p]) </span><br><span class="line"><span class="keyword">print</span> m</span><br><span class="line">n=q1*q2</span><br><span class="line">f=(q1<span class="number">-1</span>)*(q2<span class="number">-1</span>)</span><br><span class="line">m=m%n</span><br><span class="line"><span class="number">2</span>d=invmod(<span class="number">7</span>,f)</span><br><span class="line">m=pow(m,<span class="number">2</span>d,n)</span><br><span class="line"><span class="keyword">print</span> n2s(gmpy2.iroot(m, <span class="number">2</span>)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<h2 id="0x02-解密指数d"><a href="#0x02-解密指数d" class="headerlink" title="0x02 解密指数d"></a>0x02 解密指数d</h2><h3 id="低解密指数攻击"><a href="#低解密指数攻击" class="headerlink" title="低解密指数攻击"></a>低解密指数攻击</h3><p>如果满足条件<code>d &lt; (1/3)*n^(1/4)</code>,那么一种基于连分数的特殊攻击类型就可以危害RSA的安全.此时需要满足<code>q&lt;p&lt;2*q</code>,则可以通过Wiener Attack在多项式时间中分解n.常适用于e过大或过小的情况.为了理解这个过程,我们讲解维纳定理相关知识.    </p>
<ul>
<li>Wiener’s Theorem<ul>
<li>连分数展开: <code>[a0,a1,a2,....,an]</code><br><img src="http://static.zybuluo.com/B1ank/ro2jz9fgdxuyp9p7tjc2lx45/1.png" alt="1.png-5kB"><br>举例如下:<br><img src="http://static.zybuluo.com/B1ank/af7d02gk7xfeyf9q7zf9636p/3.png" alt="3.png-28.3kB"></li>
<li>渐近分数<br><img src="http://static.zybuluo.com/B1ank/mjt8cit6vxais5bwpn6t99cb/2.png" alt="2.png-0.8kB"></li>
<li>定理内容<br>如果<code>N = p*q, q&lt;p&lt;2*q, d&lt;(1/3)*N^(1/4)</code>,且已知(e,N)满足e*d $\equiv$ 1 mod $\phi$(N),攻击者可以从e/N的连分数的渐近分数中找到正确的k/d从而获得密钥d.   </li>
<li>举例<br>已知(N,e)=(90581,17993),首先求e/N的连分数的渐近分数:<br><img src="http://static.zybuluo.com/B1ank/zecvquc04wbkq38al8pp2nfz/4.png" alt="4.png-88.2kB"><br>循环k,d的值,求解方程:<br><img src="http://static.zybuluo.com/B1ank/odlq2klwyutrumz8gbi7bqaj/5.png" alt="5.png-38.5kB"><br>如果方程有两个有效解则分别为p和q.本例中当k=1,d=5时,$\phi$(N)=89964,方程存在两解x1=379,x2=293.    </li>
</ul>
</li>
<li><p>python实现 </p>
</li>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">import</span> ContinuedFractions, Arithmetic</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wiener_hack</span><span class="params">(e, n)</span>:</span></span><br><span class="line">    <span class="comment"># firstly git clone https://github.com/pablocelayes/rsa-wiener-attack.git !</span></span><br><span class="line">    frac = ContinuedFractions.rational_to_contfrac(e, n)</span><br><span class="line">    convergents = ContinuedFractions.convergents_from_contfrac(frac)</span><br><span class="line">    <span class="keyword">for</span> (k, d) <span class="keyword">in</span> convergents:</span><br><span class="line">        <span class="keyword">if</span> k != <span class="number">0</span> <span class="keyword">and</span> (e * d - <span class="number">1</span>) % k == <span class="number">0</span>:</span><br><span class="line">            phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">            s = n - phi + <span class="number">1</span></span><br><span class="line">            discr = s * s - <span class="number">4</span> * n</span><br><span class="line">            <span class="keyword">if</span> (discr &gt;= <span class="number">0</span>):</span><br><span class="line">                t = Arithmetic.is_perfect_square(discr)</span><br><span class="line">                <span class="keyword">if</span> t != <span class="number">-1</span> <span class="keyword">and</span> (s + t) % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">                    print(<span class="string">"Hacked!"</span>)</span><br><span class="line">                    <span class="keyword">return</span> d</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* github参考工具:[rsa-wiener-attack][13]</span><br><span class="line">* 典型例题    </span><br><span class="line">题目来源: 2018强网杯nextrsa-Level2    </span><br><span class="line">解题脚本:</span><br><span class="line"></span><br><span class="line">*</span><br></pre></td></tr></table></figure>
<h1 id="e与n的差距过小-考虑使用wiener’s-attack"><a href="#e与n的差距过小-考虑使用wiener’s-attack" class="headerlink" title="e与n的差距过小,考虑使用wiener’s attack"></a>e与n的差距过小,考虑使用wiener’s attack</h1><p>n = 0x92411fa0c93c1b27f89e436d8c4698bcf554938396803a5b62bd10c9bfcbf85a483bd87bb2d6a8dc00c32d8a7caf30d8899d90cb8f5838cae95f7ff5358847db1244006c140edfcc36adbdcaa16cd27432b4d50d2348b5c15c209364d7914ef50425e4c3da07612cc34e9b93b98d394b43f3eb0a5a806c70f06697b6189606eb9707104a7b6ff059011bac957e2aae9ec406a4ff8f8062400d2312a207a9e018f4b4e961c943dfc410a26828d2e88b24e4100162228a5bbf0824cf2f1c8e7b915efa385efeb505a9746e5d19967766618007ddf0d99525e9a41997217484d64c6a879d762098b9807bee46a219be76941b9ff31465463981e230eecec69691d1L<br>e = 0x6f6b385dd0f06043c20a7d8e5920802265e1baab9d692e7c20b69391cc5635dbcaae59726ec5882f168b3a292bd52c976533d3ad498b7f561c3dc01a76597e47cfe60614f247551b3dbe200e2196eaa001a1d183886eeacddfe82d80b38aea24de1a337177683ed802942827ce4d28e20efef92f38f1b1a18c66f9b45f5148cceabfd736de8ac4a49e63a8d35a83b664f9f3b00f822b6f11ff13257ee6e0c00ca5c98e661ea594a9e66f2bd56b33d9a13f5c997e67a37fcf9a0c7f04d119fe1ba261127357e64a4b069aefed3049c1c1fe4f964fd078b88bedd064abea385cfebd65e563f93c12d34eb6426e8aa321033cfd8fe8855b9e74d07fe4f9d70de46fL<br>d = wiener_hack(e, n)<br>print d  #42043<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### d泄露攻击</span><br><span class="line">如果我们知道一组过期的(N, e1, d1)和一组由新的e2组成的公钥及其加密的密文(N, e2, c),我们可以由(e1, d1)得到模数N的两个因子p和q,然后再反解d2即可求出明文.    </span><br><span class="line">### private.pem修复攻击</span><br><span class="line">当题目提供的模数N过大不可分解且同时提供破损的私钥文件时,可以考虑private.pem修复.    </span><br><span class="line"></span><br><span class="line">* 典型题目: Jarvis OJ-God Like RSA</span><br><span class="line">* 参考链接: [私钥文件修复][14]</span><br><span class="line"></span><br><span class="line">## 0x03 模数N</span><br><span class="line">### N的特殊分解</span><br><span class="line">针对大整数的分解有很多种算法,包括Fermat方法,Pollard rho p-1方法,试除法,以及椭圆曲线法,连分数法,二次筛选法,数域分析法等等.这里具体介绍Pollard rho和Fermat分解方法.    </span><br><span class="line"></span><br><span class="line">* Pollard rho p-1分解</span><br><span class="line">适用于p和q相差较大的情况.脚本如下:</span><br><span class="line"></span><br><span class="line">* ```python</span><br><span class="line">from gmpy2 import *</span><br><span class="line">def PollardRho_p_1(Q,N):</span><br><span class="line">    a = i = 2</span><br><span class="line">    while 1:</span><br><span class="line">        a = pow(a, i, N)</span><br><span class="line">        d = gcd(a - 1, N)</span><br><span class="line">        if d != 1:</span><br><span class="line">            return d</span><br><span class="line">        i += 1</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* Fermat分解</span><br><span class="line">适用于p和q相差不大的情况.脚本如下:</span><br><span class="line"></span><br><span class="line">* ```python</span><br><span class="line">from gmpy2 import *</span><br><span class="line">def Fermat(Q,n):</span><br><span class="line">    a = isqrt_rem(n)[0]+1</span><br><span class="line">    b = a ** 2 - n</span><br><span class="line">    while 1:</span><br><span class="line">        q = isqrt_rem(b)</span><br><span class="line">        if q[1] == 0:</span><br><span class="line">            return a - q[0]</span><br><span class="line">        a += 1</span><br><span class="line">        b = a ** 2 - n</span><br></pre></td></tr></table></figure>
<ul>
<li><p>典型题目<br>分解<code>n = 0x4333AF6B43F36028D8D9650EC3EED3238541EE5C15E626C58C9EC33674A6D08D5B1F2580A1A0B07E9D853536CD994E197889D122701A62BB2A9E79559F3D5281014535F6C54F83CA8D9700EEB67D99AF318D20A5150AD46D622A6A12DE0A758EE7DF75F5D10F2FE2585F2348537787063321FFDAC91BB3C3D1D88CBD04A824ED</code>.<br>分解脚本如下:</p>
</li>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">n = given_n</span><br><span class="line">x2 = <span class="number">1</span></span><br><span class="line">c = <span class="number">7</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">  x1 = randint(<span class="number">1</span>, n)</span><br><span class="line">  x2 = pow(x2,<span class="number">2</span>,n)+c%n</span><br><span class="line">  fac = gcd(abs(x1-x2),n)</span><br><span class="line">  <span class="keyword">if</span> fac&gt;<span class="number">1</span> <span class="keyword">and</span> is_prime(fac):</span><br><span class="line">      <span class="keyword">print</span> fac</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span> n/fac</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 共模攻击</span><br><span class="line">当明文m、模数n相同,公钥指数e、密文c不同且`gcd(e1,e2)==1`时,我们可以采取共模攻击来直接还原出明文.下面简单进行证明:    </span><br><span class="line">$\because$ gcd(e1,e2)==1  </span><br><span class="line">$\therefore$存在s2,使得s1\*e1+s2\*e2=1  </span><br><span class="line">又$\because$ c1 $\equiv$ m^e1 mod n,c2 $\equiv$ m^e2 mod n    </span><br><span class="line">$\therefore$ c1^e1*c2^e2 $\equiv$ m mod n  </span><br><span class="line"></span><br><span class="line">* python实现 </span><br><span class="line"></span><br><span class="line">* ```python</span><br><span class="line">def common_modulus(n, e1, e2, c1, c2):</span><br><span class="line">	assert (libnum.gcd(e1, e2) == 1)</span><br><span class="line">	_, s1, s2 = gmpy2.gcdext(e1, e2)</span><br><span class="line">	# 若s1&lt;0，则c1^s1==(c1^-1)^(-s1)，其中c1^-1为c1模n的逆元。</span><br><span class="line">	m = pow(c1, s1, n) if s1 &gt; 0 else pow(gmpy2.invert(c1, n), -s1, n)</span><br><span class="line">	m *= pow(c2, s2, n) if s2 &gt; 0 else pow(gmpy2.invert(c2, n), -s2, n)</span><br><span class="line">	return m % n</span><br></pre></td></tr></table></figure>
<ul>
<li><p>典型例题<br>题目来源: buuctf RSA3<br>题目分析: 该题给出了c1,c2,e1,e2和n,显然使用共模攻击.<br>解题脚本:</p>
</li>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exgcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">  <span class="keyword">if</span> b==<span class="number">0</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, a</span><br><span class="line">  x2, y2, r = exgcd(b, a%b)</span><br><span class="line">  x1 = y2</span><br><span class="line">  y1 = x2-(a//b)*y2</span><br><span class="line">  <span class="keyword">return</span> x1, y1, r</span><br><span class="line">c1=gp.mpz(c1)</span><br><span class="line">n=gp.mpz(n)</span><br><span class="line">e1=gp.mpz(e1)</span><br><span class="line">c2=gp.mpz(c2)</span><br><span class="line">e2=gp.mpz(e2)</span><br><span class="line">r1, r2, t = exgcd(e1, e2)</span><br><span class="line">m = gp.powmod(c1, r1, n) * gp.powmod(c2, r2, n) % n</span><br><span class="line">print(m)</span><br><span class="line">print(hex(m)[<span class="number">2</span>:])</span><br><span class="line">print(bytes.fromhex(str(hex(m)[<span class="number">2</span>:])))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 公共因子攻击</span><br><span class="line">当题目给出同一个(m,e)使用较多组N加密后的多组(N,c)时,可以循环求解这些N的最大公因数.如果存在`gcd(Ni,Nj)!= 1`,则可以顺利分解Ni和Nj,从而还原明文.  </span><br><span class="line"> </span><br><span class="line">* python实现  </span><br><span class="line"></span><br><span class="line">*  ```python</span><br><span class="line">def common_primes(data):</span><br><span class="line"># 按照data[0]=n1,data[1]=e1,data[2]=n2,....的顺序构造数组data</span><br><span class="line">	for i in range(len(data)//2):</span><br><span class="line">		for j in range(i+1,len(data)//2):</span><br><span class="line">			if math.gcd(data[2*i],data[2*j]) != 1:</span><br><span class="line">				print(&quot;[+]Successfully found!&quot;)</span><br><span class="line">				print(&quot;    [-]n1 =&quot; + str(data[2*i]))</span><br><span class="line">				print(&quot;    [-]n2 =&quot; + str(data[2*j]))</span><br><span class="line">				print(&quot;[+]One possible decomposition:&quot;)</span><br><span class="line">				print(&quot;    [!]p = &quot; + str(math.gcd(data[2*i],data[2*j])))</span><br><span class="line">				print(&quot;    [!]q = &quot; + str(data[2*i]//math.gcd(data[2*i],data[2*j])))</span><br><span class="line">				exit()</span><br></pre></td></tr></table></figure>
<ul>
<li><p>典型题目<br>题目来源: buuctf RSA5<br>题目分析: 题目给出了e=65537,以及二十组对应的(n,c).由于所给的信息数量较多,考虑公共因子攻击.构造符合上文所给脚本的数组data,然后寻找拥有公共因子的模数对,最后还原明文.<br>解题脚本: </p>
</li>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gp</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">data = [given_n_and_e_combinations]</span><br><span class="line">e = gp.mpz(<span class="number">65537</span>)</span><br><span class="line">common_primes(data)</span><br><span class="line"><span class="comment"># then we get the results as follows:</span></span><br><span class="line">n = gp.mpz(n)</span><br><span class="line">c = gp.mpz(c)</span><br><span class="line">d = gp.mpz(d)</span><br><span class="line">m = gp.powmod(c,d,n)</span><br><span class="line">print(m)</span><br><span class="line">print(binascii.a2b_hex(str(m))[<span class="number">2</span>:])</span><br><span class="line"><span class="comment"># flag = flag&#123;abdcbe5fd94e23b3de429223ab9c2fdf&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="0x04-密文c"><a href="#0x04-密文c" class="headerlink" title="0x04 密文c"></a>0x04 密文c</h2><h3 id="选择密文攻击"><a href="#选择密文攻击" class="headerlink" title="选择密文攻击"></a>选择密文攻击</h3><p>该类攻击适用于可以构造任意密文并获得对应明文的情况.<br>在一个RSA加密过程中,明文为m,密文为c,模数为n,加密指数为e,选取x以满足<code>gcd(x,n)==1</code>从而使x模n的逆存在,构造密文<code>c&#39;=c*(x^e)</code>,使解密后的明文为<code>m&#39;=(m*x)%n</code>,则<code>m=m&#39;*x^(-1)(mod n)</code>.    </p>
<h3 id="LSB-Oracle-Attack"><a href="#LSB-Oracle-Attack" class="headerlink" title="LSB Oracle Attack"></a>LSB Oracle Attack</h3><p>假如用户知道公钥中N, e, c,并且可以任意构造密文c1,返回此密文解密后p1的末尾某些比特位的性质(记为函数f).最简单的函数f是表示p1的奇偶性.<br>攻击者构造密文<code>c&#39;=((2^e)*c)%n=((2^e)*(m^e))%n=((2*m)^e)%n</code>,返回明文<code>m&#39;=(2*m)%n</code>及m’的lsb.下面继续分析,因为n是奇数,而2*m是偶数,所以如果lsb=0,则<code>(2\*m)%n</code>是偶数,没有超过n,从而确定<code>m&lt;n/2.0</code>,反之则<code>m&gt;n/2.0</code>.<br>以此类推,构造密文<code>c&#39;&#39;=((4^e)*c)%n</code>使其解密后有<code>m&#39;&#39;=(4*m)%n</code>,判断m’’的奇偶性就可以知道m和n/4的大小关系.此时我们得到一个在对数时间内将m的范围逼近到一个足够小范围的二分算法.      </p>
<ul>
<li><p>python实现</p>
</li>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> decimal</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">oracle</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> lsb == <span class="string">'odd'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial</span><span class="params">(c, e, n)</span>:</span></span><br><span class="line">    k = n.bit_length()</span><br><span class="line">    decimal.getcontext().prec = k  <span class="comment"># for 'precise enough' floats</span></span><br><span class="line">    lo = decimal.Decimal(<span class="number">0</span>)</span><br><span class="line">    hi = decimal.Decimal(n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> oracle(c):</span><br><span class="line">            hi = (lo + hi) / <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            lo = (lo + hi) / <span class="number">2</span></span><br><span class="line">        c = (c * pow(<span class="number">2</span>, e, n)) % n</span><br><span class="line">        <span class="comment"># print i, int(hi - lo)</span></span><br><span class="line">    <span class="keyword">return</span> int(hi)</span><br></pre></td></tr></table></figure>
</li>
<li><p>题目一: QCTF 2018-XMan选拔赛/Baby RSA<br>题目描述:   </p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">n = <span class="number">0x0b765daa79117afe1a77da7ff8122872bbcbddb322bb078fe0786dc40c9033fadd639adc48c3f2627fb7cb59bb0658707fe516967464439bdec2d6479fa3745f57c0a5ca255812f0884978b2a8aaeb750e0228cbe28a1e5a63bf0309b32a577eecea66f7610a9a4e720649129e9dc2115db9d4f34dc17f8b0806213c035e22f2c5054ae584b440def00afbccd458d020cae5fd1138be6507bc0b1a10da7e75def484c5fc1fcb13d11be691670cf38b487de9c4bde6c2c689be5adab08b486599b619a0790c0b2d70c9c461346966bcbae53c5007d0146fc520fa6e3106fbfc89905220778870a7119831c17f98628563ca020652d18d72203529a784ca73716db</span></span><br><span class="line">c = <span class="number">0x4f377296a19b3a25078d614e1c92ff632d3e3ded772c4445b75e468a9405de05d15c77532964120ae11f8655b68a630607df0568a7439bc694486ae50b5c0c8507e5eecdea4654eeff3e75fb8396e505a36b0af40bd5011990663a7655b91c9e6ed2d770525e4698dec9455db17db38fa4b99b53438b9e09000187949327980ca903d0eef114afc42b771657ea5458a4cb399212e943d139b7ceb6d5721f546b75cd53d65e025f4df7eb8637152ecbb6725962c7f66b714556d754f41555c691a34a798515f1e2a69c129047cb29a9eef466c206a7f4dbc2cea1a46a39ad3349a7db56c1c997dc181b1afcb76fa1bbbf118a4ab5c515e274ab2250dba1872be0</span></span><br><span class="line">λ nc <span class="number">47.96</span><span class="number">.239</span><span class="number">.28</span> <span class="number">23333</span></span><br><span class="line">----------------------------- baby rsa -----------------------------</span><br><span class="line">Come <span class="keyword">and</span> Decode your data</span><br><span class="line">If you give me ciphertext, I can tell you whether decoded data <span class="keyword">is</span> even <span class="keyword">or</span> odd</span><br><span class="line">You can input ciphertext(hexdecimal) now</span><br><span class="line"><span class="number">1</span></span><br><span class="line">odd</span><br><span class="line"> </span><br><span class="line">solve.py</span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> libnum, gmpy2, socket, time, decimal</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">oracle</span><span class="params">(c1)</span>:</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    hostname = <span class="string">'47.96.239.28'</span></span><br><span class="line">    port = <span class="number">23333</span></span><br><span class="line">    s.connect((hostname, port))</span><br><span class="line">    s.recv(<span class="number">1024</span>)</span><br><span class="line">    s.send(hex(c1)[<span class="number">2</span>:].strip(<span class="string">"lL"</span>) + <span class="string">'\n'</span>)</span><br><span class="line">    res = s.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    s.close()</span><br><span class="line">    <span class="keyword">if</span> res == <span class="string">'even'</span>: <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> res == <span class="string">'odd'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">assert</span> (<span class="number">0</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial</span><span class="params">(c, n)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> c_of_2</span><br><span class="line">    k = n.bit_length()</span><br><span class="line">    decimal.getcontext().prec = k  <span class="comment"># allows for 'precise enough' floats</span></span><br><span class="line">    lower = decimal.Decimal(<span class="number">0</span>)</span><br><span class="line">    upper = decimal.Decimal(n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</span><br><span class="line">        possible_plaintext = (lower + upper) / <span class="number">2</span></span><br><span class="line">        <span class="comment"># lower==0 when i&lt;1809</span></span><br><span class="line">        flag = oracle(c)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            upper = possible_plaintext  <span class="comment"># plaintext is in the lower half</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            lower = possible_plaintext  <span class="comment"># plaintext is in the upper half</span></span><br><span class="line">        c = (c * c_of_2) % n  <span class="comment"># multiply y by the encryption of 2 again</span></span><br><span class="line">        <span class="keyword">print</span> i, flag, int(upper - lower)</span><br><span class="line">        <span class="comment"># time.sleep(0.2)</span></span><br><span class="line">    <span class="comment"># By now, our plaintext is revealed!</span></span><br><span class="line">    <span class="keyword">return</span> int(upper)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"[*] Conducting Oracle attack..."</span></span><br><span class="line">    <span class="keyword">return</span> partial((c * c_of_2) % n, n)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    e = given_e</span><br><span class="line">    n = given_n</span><br><span class="line">    c = given_c</span><br><span class="line">    c_of_2 = pow(<span class="number">2</span>, e, n)</span><br><span class="line">    m = main()</span><br><span class="line">    <span class="comment"># m = 560856645743734814774953158390773525781916094468093308691660509501812349</span></span><br><span class="line">    <span class="keyword">print</span> libnum.n2s(m)</span><br><span class="line">    <span class="comment"># QCTF&#123;RSA_parity_oracle_is_fun&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>题目二:Backdoor CTF2018 BIT-LEAKER     </p>
</li>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server.py</span><br><span class="line"><span class="comment">#!/usr/bin/python -u</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="comment">#from SECRET import flag</span></span><br><span class="line">flag = <span class="string">"CTF&#123;this_is_my_test_flag&#125;"</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">key = RSA.generate(<span class="number">1024</span>)</span><br><span class="line">c = pow(m, key.e, key.n)</span><br><span class="line">print(<span class="string">"Welcome to BACKDOORCTF17\n"</span>)</span><br><span class="line">print(<span class="string">"PublicKey:\n"</span>)</span><br><span class="line">print(<span class="string">"N = "</span> + str(key.n) + <span class="string">"\n"</span>)</span><br><span class="line">print(<span class="string">"e = "</span> + str(key.e) + <span class="string">"\n"</span>)</span><br><span class="line">print(<span class="string">"c = "</span> + str(c) + <span class="string">"\n"</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        temp_c = int(raw_input(<span class="string">"temp_c = "</span>))</span><br><span class="line">        temp_m = pow(temp_c, key.d, key.n)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    l = str(((temp_m&amp;<span class="number">5</span>) * random.randint(<span class="number">1</span>,<span class="number">10000</span>))%(<span class="number">2</span>*(random.randint(<span class="number">1</span>,<span class="number">10000</span>))))</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"l = "</span>+l</span><br></pre></td></tr></table></figure>
</li>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">solve.py</span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">import</span> Crypto</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify,unhexlify</span><br><span class="line"><span class="keyword">if</span> len(sys.argv)&gt;<span class="number">1</span>:</span><br><span class="line">    p=remote(<span class="string">"127.0.0.1"</span>,<span class="number">2334</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote(<span class="string">'127.0.0.1'</span>,<span class="number">2333</span>)</span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">oracle</span><span class="params">(c)</span>:</span></span><br><span class="line">    l = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">        p.sendline(str(c))</span><br><span class="line">        s = p.recvuntil(<span class="string">"temp_c"</span>)</span><br><span class="line">        l.append(int(re.findall(<span class="string">"l\s*=\s*([0-9]*)"</span>,s)[<span class="number">0</span>]))</span><br><span class="line">    flag0 = <span class="number">0</span></span><br><span class="line">    flag2 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">        <span class="keyword">if</span> l[i]%<span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">            flag0 = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> l[i] &gt; <span class="number">10000</span>:</span><br><span class="line">            flag2 = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> [flag2,flag0]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    ss = p.recvuntil(<span class="string">"temp_c"</span>)</span><br><span class="line">    N = int(re.findall(<span class="string">"N\s*=\s*(\d+)"</span>,ss)[<span class="number">0</span>])</span><br><span class="line">    e = int(re.findall(<span class="string">"e\s*=\s*(\d+)"</span>,ss)[<span class="number">0</span>])</span><br><span class="line">    c = int(re.findall(<span class="string">"c\s*=\s*(\d+)"</span>,ss)[<span class="number">0</span>])</span><br><span class="line">    size = libnum.len_in_bits(N)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"N="</span>,N</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"e="</span>,e</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"c="</span>,c</span><br><span class="line">    c = (pow(<span class="number">2</span>,e,N)*c)%N</span><br><span class="line">    LB = <span class="number">0</span></span><br><span class="line">    UB = N</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> LB!=UB:</span><br><span class="line">        flag = oracle(c)</span><br><span class="line">        <span class="keyword">print</span> i,flag</span><br><span class="line">        <span class="keyword">if</span> flag[<span class="number">1</span>]%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">            UB = (LB+UB)/<span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            LB = (LB+UB)/<span class="number">2</span></span><br><span class="line">        c = (pow(<span class="number">2</span>,e,N)*c)%N</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">print</span> LB</span><br><span class="line">    <span class="keyword">print</span> UB</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">-128</span>,<span class="number">128</span>,<span class="number">0</span>):</span><br><span class="line">        LB += i</span><br><span class="line">        <span class="keyword">if</span> pow(LB,e,N)==C:</span><br><span class="line">            <span class="keyword">print</span> unhexlify(hex(LB)[<span class="number">2</span>:<span class="number">-1</span>])</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br><span class="line">    p.interactive()</span><br></pre></td></tr></table></figure>
</li>
<li><p>参考链接: <a href="https://introspelliam.github.io/2018/03/27/crypto/RSA-Least-Significant-Bit-Oracle-Attack/" target="_blank" rel="noopener">RSA Least-Significant-Bit Oracle Attack</a></p>
</li>
</ul>
<h2 id="0x05-综合应用"><a href="#0x05-综合应用" class="headerlink" title="0x05 综合应用"></a>0x05 综合应用</h2><p>通过一道题目分析说明RSA的综合应用.<br>题目来源: 2019De1CTF BabyRSA<br>题目描述: 题目提供的脚本如下.  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> data <span class="keyword">import</span> e1,e2,p,q1p,q1q,hint,flag</span><br><span class="line"></span><br><span class="line">n =  [n1, n2, n3, n4]</span><br><span class="line">c =  [c1, c2, c3, c4]</span><br><span class="line">f=<span class="keyword">lambda</span> m,e,n,c:pow(m,e,n)==c</span><br><span class="line"><span class="keyword">assert</span>(sum(map(f,[p]*<span class="number">4</span>,[<span class="number">4</span>]*<span class="number">4</span>,n,c))==<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">ee1 = <span class="number">42</span></span><br><span class="line">ee2 = <span class="number">3</span></span><br><span class="line">ce1 =  <span class="number">45722651786340123946960815003059322528810481841378247280642868553607692149509126962872583037142461398806689489141741494974836882341505234255325683219092163052843461632338442529011502378931140356111756932712822516814023166068902569458299933391973504078898958921809723346229893913662577294963528318424676803942288386430172430880307619748186863890050113934573820505570928109017842647598266634344447182347849367714564686341871007505886728393751147033556889217604647355628557502208364412269944908011305064122941446516990168924709684092200183860653173856272384</span></span><br><span class="line">ce2 =  <span class="number">13908468332333567158469136439932325992349696889129103935400760239319454409539725389747059213835238373047899198211128689374049729578146875309231962936554403287882999967840346216695208424582739777034261079550395918048421086843927009452479936045850799096750074359160775182238980989229190157551197830879877097703347301072427149474991803868325769967332356950863518504965486565464059770451458557744949735282131727956056279292800694203866167270268988437389945703117070604488999247750139568614939965885211276821987586882908159585863514561191905040244967655444219603287214405014887994238259270716355378069726760953320025828158</span></span><br><span class="line">tmp =  <span class="number">864078778078609835167779565982540757684070450697854309005171742813414963447462554999012718960925081621571487444725528982424037419052194840720949809891134854871222612682162490991065015935449289960707882463387</span></span><br><span class="line">n  =  <span class="number">15911581555796798614711625288508309704791837516232122410440958830726078821069050404012820896260071751380436992710638364294658173571101596931605797509712839622479368850251206419748090059752427303611760004621378226431226983665746837779056271530181865648115862947527212787824629516204832313026456390047768174765687040950636530480549014401279054346098030395100387004111574278813749630986724706263655166289586230453975953773791945408589484679371854113457758157492241225180907090235116325034822993748409011554673180494306003272836905082473475046277554085737627846557240367696214081276345071055578169299060706794192776825039</span></span><br><span class="line"><span class="keyword">assert</span>(pow(e1,ee1,n)==ce1)</span><br><span class="line"><span class="keyword">assert</span>(pow(e2+tmp,ee2,n)==ce2)</span><br><span class="line"></span><br><span class="line">e = <span class="number">46531</span></span><br><span class="line">n = <span class="number">16278524034278364842964386062476113517067911891699789991355982121084973951738324063305190630865511554888330215827724887964565979607808294168282995825864982603759381323048907814961279012375346497781046417204954101076457350988751188332353062731641153547102721113593787978587135707313755661153376485647168543680503160420091693269984008764444291289486805840439906620313162344057956594836197521501755378387944609246120662335790110901623740990451586621846212047950084207251595169141015645449217847180683357626383565631317253913942886396494396189837432429078251573229378917400841832190737518763297323901586866664595327850603</span></span><br><span class="line">c = <span class="number">14992132140996160330967307558503117255626925777426611978518339050671013041490724616892634911030918360867974894371539160853827180596100892180735770688723270765387697604426715670445270819626709364566478781273676115921657967761494619448095207169386364541164659123273236874649888236433399127407801843412677293516986398190165291102109310458304626261648346825196743539220198199366711858135271877662410355585767124059539217274691606825103355310348607611233052725805236763220343249873849646219850954945346791015858261715967952461021650307307454434510851869862964236227932964442289459508441345652423088404453536608812799355469</span></span><br><span class="line">hint=int(binascii.hexlify(hint),<span class="number">16</span>)</span><br><span class="line"><span class="keyword">assert</span>(q1p*q1q==n)</span><br><span class="line"><span class="keyword">assert</span>(q1p&lt;q1q)</span><br><span class="line"><span class="keyword">assert</span>(c==pow(hint,e,n))</span><br><span class="line"></span><br><span class="line">flag=int(binascii.hexlify(flag),<span class="number">16</span>)</span><br><span class="line">q1=q1p</span><br><span class="line">q2 =  <span class="number">114401188227479584680884046151299704656920536168767132916589182357583461053336386996123783294932566567773695426689447410311969456458574731187512974868297092638677515283584994416382872450167046416573472658841627690987228528798356894803559278308702635288537653192098514966089168123710854679638671424978221959513</span></span><br><span class="line">c1 =  <span class="number">262739975753930281690942784321252339035906196846340713237510382364557685379543498765074448825799342194332681181129770046075018122033421983227887719610112028230603166527303021036386350781414447347150383783816869784006598225583375458609586450854602862569022571672049158809874763812834044257419199631217527367046624888837755311215081173386523806086783266198390289097231168172692326653657393522561741947951887577156666663584249108899327053951891486355179939770150550995812478327735917006194574412518819299303783243886962455399783601229227718787081785391010424030509937403600351414176138124705168002288620664809270046124</span></span><br><span class="line">c2 =  <span class="number">7395591129228876649030819616685821899204832684995757724924450812977470787822266387122334722132760470911599176362617225218345404468270014548817267727669872896838106451520392806497466576907063295603746660003188440170919490157250829308173310715318925771643105064882620746171266499859049038016902162599261409050907140823352990750298239508355767238575709803167676810456559665476121149766947851911064706646506705397091626648713684511780456955453552020460909638016134124590438425738826828694773960514221910109473941451471431637903182205738738109429736425025621308300895473186381826756650667842656050416299166317372707709596</span></span><br><span class="line"><span class="keyword">assert</span>(c1==pow(flag,e1,p*q1))</span><br><span class="line"><span class="keyword">assert</span>(c2==pow(flag,e2,p*q2))</span><br></pre></td></tr></table></figure>
<p>(由于数组n和c中的数字较多,故使用n1-n4,c1-c4代替表示)<br>题目分析:本题思路非常明确,空行将脚本分成四个部分,我们逐个部分解决.<br>第一部分: 给出了n1-n4和c1-c4,且sum()函数返回的结果为4,我们可以得到如下同余方程组:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c1 = p^4 mod n1</span><br><span class="line">c2 = p^4 mod n2</span><br><span class="line">c3 = p^4 mod n3</span><br><span class="line">c4 = p^4 mod n4</span><br></pre></td></tr></table></figure>
<p>联想到使用中国剩余定理解决,我们得到大素数p.<br>第二部分: 给出了两个较小的加密指数<code>e1=42</code>,<code>e2=3</code>,联想到使用低加密指数攻击.分别使用<code>gmpy2.iroot()</code>函数进行爆破处理,可以得到e1和e2.<br>第三部分: 该加密过程没有其他的办法,只能使用yafu进行模数分解.分解结果可以看出,p,q的差距不大,所以使用了Fermat分解法.<br>第四部分: 经过前三部分的解密,我们得到了如下参数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">加密指数e1,e2</span><br><span class="line">大素数p,q1,q2</span><br></pre></td></tr></table></figure>
<p>再加上第四部分所给的c1,c2,我们有如下rsa问题: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c1 % p*q1 = flag^e1 % p*q1</span><br><span class="line">c2 % p*q2 = flag^e2 % p*q2</span><br></pre></td></tr></table></figure>
<p>通过观察发现e1,e2与$\phi$(p*q1),$\phi$(p*q2)不互素,属于e与$\phi$(n)不互素的情况.而且我们发现<code>gcd(e1,p*q1)=gcd(e2,p*q2)=14</code>,按照上面的推导步骤,最终得到m^2 $\equiv$ c^(2*d) (mod q1*q2).进行开方爆破,最终得到flag.<br>解密脚本如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="keyword">import</span> binascii,gmpy2</span><br><span class="line"><span class="comment"># from data import e1,e2,p,q1p,q1q,hint,flag,q2</span></span><br><span class="line"></span><br><span class="line">n =  [n1, n2, n3, n4]</span><br><span class="line">c =  [c1, c2, c3, c4]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 中国剩余定理解决低加密指数广播攻击</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CRT</span><span class="params">(mi, ai)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(reduce(gmpy2.gcd,mi)==<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">assert</span> (isinstance(mi, list) <span class="keyword">and</span> isinstance(ai, list))</span><br><span class="line">    M = reduce(<span class="keyword">lambda</span> x, y: x * y, mi)</span><br><span class="line">    ai_ti_Mi = [a * (M / m) * gmpy2.invert(M / m, m) <span class="keyword">for</span> (m, a) <span class="keyword">in</span> zip(mi, ai)]</span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x, y: x + y, ai_ti_Mi) % M</span><br><span class="line"></span><br><span class="line">p=gmpy2.iroot(CRT(n, c), <span class="number">4</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">"p = "</span>,p</span><br><span class="line"><span class="comment"># ====================got p</span></span><br><span class="line">ee1 = <span class="number">42</span></span><br><span class="line">ee2 = <span class="number">3</span></span><br><span class="line">ce1 =  number_ce1</span><br><span class="line">ce2 =  number_ce2</span><br><span class="line">tmp =  number_tmp1</span><br><span class="line">n  =  number_n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用gmpy2.iroot()函数直接爆破</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">200000</span>):</span><br><span class="line">	<span class="keyword">if</span> gmpy2.iroot(ce1+n*i,<span class="number">42</span>)[<span class="number">1</span>]==<span class="number">1</span>:</span><br><span class="line">		res=gmpy2.iroot(ce1+n*i,<span class="number">42</span>)[<span class="number">0</span>]</span><br><span class="line">		e1=res</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">200000</span>):</span><br><span class="line">	<span class="keyword">if</span> gmpy2.iroot(ce2+n*i,<span class="number">3</span>)[<span class="number">1</span>]==<span class="number">1</span>:</span><br><span class="line">		res=gmpy2.iroot(ce2+n*i,<span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line">		e2=res-tmp</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"e1 = "</span>,e1</span><br><span class="line"><span class="keyword">print</span> <span class="string">"e2 = "</span>,e2</span><br><span class="line"><span class="comment"># ====================got e1,e2</span></span><br><span class="line">e = number_e</span><br><span class="line">n = number_n</span><br><span class="line">c = number_c</span><br><span class="line"></span><br><span class="line"><span class="comment"># yafu got q1p,q1q</span></span><br><span class="line">q1p = result_q1p</span><br><span class="line">q1q = result_q1q</span><br><span class="line"><span class="keyword">if</span> q1p&gt;q1q:</span><br><span class="line">	q1p,q1q=q1q,q1p</span><br><span class="line"></span><br><span class="line"><span class="comment"># below is not necessary</span></span><br><span class="line">phi=(q1p<span class="number">-1</span>)*(q1q<span class="number">-1</span>)</span><br><span class="line"><span class="keyword">assert</span>(gmpy2.gcd(e,phi)==<span class="number">1</span>)</span><br><span class="line">d=gmpy2.invert(e,phi)</span><br><span class="line">hint=pow(c,d,n)</span><br><span class="line">hint=binascii.unhexlify(hex(hint)[<span class="number">2</span>:])</span><br><span class="line"><span class="keyword">print</span> <span class="string">"hint = "</span>,hint</span><br><span class="line"><span class="comment"># ====================got  q1p as q1</span></span><br><span class="line"><span class="comment"># flag=int(binascii.hexlify(flag),16)</span></span><br><span class="line">q1 = q1p</span><br><span class="line"><span class="keyword">print</span> <span class="string">"q1 = "</span>,q1</span><br><span class="line">q2 =  number_q2</span><br><span class="line">c1 =  number_c1</span><br><span class="line">c2 =  number_c2</span><br><span class="line"><span class="keyword">assert</span>(<span class="number">14</span>==gmpy2.gcd(e1,(p<span class="number">-1</span>)*(q1<span class="number">-1</span>)))</span><br><span class="line"><span class="keyword">assert</span>(<span class="number">14</span>== gmpy2.gcd(e2,(p<span class="number">-1</span>)*(q2<span class="number">-1</span>)))</span><br><span class="line">e1=e1//<span class="number">14</span>;e2=e2//<span class="number">14</span></span><br><span class="line">n1=p*q1;n2=p*q2</span><br><span class="line">phi1=(p<span class="number">-1</span>)*(q1<span class="number">-1</span>);phi2=(p<span class="number">-1</span>)*(q2<span class="number">-1</span>)</span><br><span class="line">d1=gmpy2.invert(e1,phi1);d2=gmpy2.invert(e2,phi2)</span><br><span class="line">f1=pow(c1,d1,n1);f2=pow(c2,d2,n2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当模数与加密次方不互素时使用中国剩余定理合并</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GCRT</span><span class="params">(mi, ai)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> (isinstance(mi, list) <span class="keyword">and</span> isinstance(ai, list))</span><br><span class="line">    curm, cura = mi[<span class="number">0</span>], ai[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> (m, a) <span class="keyword">in</span> zip(mi[<span class="number">1</span>:], ai[<span class="number">1</span>:]):</span><br><span class="line">        d = gmpy2.gcd(curm, m)</span><br><span class="line">        c = a - cura</span><br><span class="line">        <span class="keyword">assert</span> (c % d == <span class="number">0</span>)</span><br><span class="line">        K = c // d * gmpy2.invert(curm // d, m // d)</span><br><span class="line">        cura += curm * K</span><br><span class="line">        curm = curm * m // d</span><br><span class="line">        cura %= curm</span><br><span class="line">    <span class="keyword">return</span> (cura % curm, curm) </span><br><span class="line"></span><br><span class="line">f3,lcm = GCRT([n1,n2],[f1,f2])</span><br><span class="line"><span class="keyword">assert</span>(f3%n1==f1);<span class="keyword">assert</span>(f3%n2==f2);<span class="keyword">assert</span>(lcm==q1*q2*p)</span><br><span class="line">n3=q1*q2</span><br><span class="line">c3=f3%n3</span><br><span class="line">phi3=(q1<span class="number">-1</span>)*(q2<span class="number">-1</span>)</span><br><span class="line"><span class="keyword">assert</span>(gmpy2.gcd(<span class="number">7</span>,phi3)==<span class="number">1</span>)</span><br><span class="line">d3=gmpy2.invert(<span class="number">7</span>,phi3)</span><br><span class="line">m3=pow(c3,d3,n3)</span><br><span class="line"><span class="keyword">if</span> gmpy2.iroot(m3,<span class="number">2</span>)[<span class="number">1</span>] == <span class="number">1</span>:</span><br><span class="line">    flag=gmpy2.iroot(m3,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">    print(binascii.unhexlify(hex(flag)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># de1ctf&#123;9b10a98b-71bb-4bdf-a6ff-f319943de21f&#125;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/blank-vax.github.io/tags/RSA/" rel="tag"><i class="fa fa-tag"></i> RSA</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blank-vax.github.io/2019/08/03/RSA算法及攻击方法(一)/" rel="next" title="RSA算法及攻击方法(一)">
                <i class="fa fa-chevron-left"></i> RSA算法及攻击方法(一)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blank-vax.github.io/2019/08/21/RSA-Coppersmith相关攻击/" rel="prev" title="RSA-Coppersmith相关攻击">
                RSA-Coppersmith相关攻击 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/blank-vax.github.io/uploads/picture.png" alt="B1ank">
            
              <p class="site-author-name" itemprop="name">B1ank</p>
              <p class="site-description motion-element" itemprop="description">U can be what you wanna B</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/blank-vax.github.io/archives/">
              
                  <span class="site-state-item-count">42</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/blank-vax.github.io/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/blank-vax.github.io/tags/index.html">
                  <span class="site-state-item-count">43</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/blank-vax.github.io/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/blank-vax" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:18682924517@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://lzwgiter.github.io" title="flo@t" target="_blank">flo@t</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://alicerabbit.github.io" title="Compass" target="_blank">Compass</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://k1ng0fic3.github.io" title="k1ng0fic3" target="_blank">k1ng0fic3</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://59lx.github.io" title="rt95" target="_blank">rt95</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x00-前言"><span class="nav-number">1.</span> <span class="nav-text">0x00 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-加密指数e"><span class="nav-number">2.</span> <span class="nav-text">0x01 加密指数e</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Rabin加密"><span class="nav-number">2.1.</span> <span class="nav-text">Rabin加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#低加密指数攻击"><span class="nav-number">2.2.</span> <span class="nav-text">低加密指数攻击</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#低加密指数广播攻击"><span class="nav-number">2.3.</span> <span class="nav-text">低加密指数广播攻击</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e与-phi-n-不互素"><span class="nav-number">2.4.</span> <span class="nav-text">e与$\phi$(n)不互素</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-解密指数d"><span class="nav-number">3.</span> <span class="nav-text">0x02 解密指数d</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#低解密指数攻击"><span class="nav-number">3.1.</span> <span class="nav-text">低解密指数攻击</span></a></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#e与n的差距过小-考虑使用wiener’s-attack"><span class="nav-number"></span> <span class="nav-text">e与n的差距过小,考虑使用wiener’s attack</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-密文c"><span class="nav-number">1.</span> <span class="nav-text">0x04 密文c</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#选择密文攻击"><span class="nav-number">1.1.</span> <span class="nav-text">选择密文攻击</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LSB-Oracle-Attack"><span class="nav-number">1.2.</span> <span class="nav-text">LSB Oracle Attack</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x05-综合应用"><span class="nav-number">2.</span> <span class="nav-text">0x05 综合应用</span></a></li></ol></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">B1ank</span>

  
</div>


 <div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  访客数量:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

 <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共126.9k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
   <!-- ҳ����С���� -->
  <script type="text/javascript" src="/js/src/love.js"></script>

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/blank-vax.github.io/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/blank-vax.github.io/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/blank-vax.github.io/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/blank-vax.github.io/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blank-vax.github.io/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blank-vax.github.io/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/blank-vax.github.io/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/blank-vax.github.io/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/blank-vax.github.io/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/blank-vax.github.io/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/blank-vax.github.io/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/blank-vax.github.io/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/blank-vax.github.io/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/blank-vax.github.io/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: '9OdpjYSHQirwAMeIVy8C5SBk-gzGzoHsz',
        appKey: 'WoxonMaRanAKt1yVo9JgIS7n',
        placeholder: 'Let's Chat',
        avatar:'/uploads/picture.png',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("YPjXkPpqx6UDV4Qi9FeAtmb7-gzGzoHsz", "ftBBWgvQkPRDCOJfwV7zzsfr");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  


  

<script src="/blank-vax.github.io/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
